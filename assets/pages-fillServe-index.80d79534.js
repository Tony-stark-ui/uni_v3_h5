import{a2 as e,a3 as a,x as r,B as s,C as t,o as i,g as l,e as d,w as n,A as o,c as u,f as c,L as m,j as p,a4 as g,a8 as f,a9 as v,aa as b,ab as x,k as y}from"./index.338b6ccd.js";import{f as h}from"./enterpriseLeader.1c39928d.js";import{_ as I}from"./u-upload.db51c592.js";import{a as q}from"./u-button.6883e742.js";import{_ as T,a as j}from"./index.bc11c543.js";import{P as _,c as w}from"./base.0d2f687c.js";import"regenerator-runtime";import"./u-icon.1aa3d7c1.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./uni-datetime-picker.5cec1977.js";import"./uni-icons.a9b6e36d.js";import"./u--textarea.97b5a670.js";const A={formItems:[{renderType:_.INPUT,placeholder:"请输入服务内容",dataIndex:"content",type:"text",label:"服务内容",required:!0},{renderType:_.INPUT,placeholder:"请输入",dataIndex:"questionNum",type:"number",label:"解决问题数量",required:!0},{renderType:_.DATE_PICKER,dataIndex:"serviceDate",label:"服务日期",required:!0},{renderType:_.SLOT,dataIndex:"imgs",label:"图片",required:!0},{renderType:_.SLOT,dataIndex:"realAddress",label:"位置",required:!0},{renderType:_.TEXTAREA,placeholder:"请输入",dataIndex:"process",type:"text",label:"过程记录",required:!0}],rules:{content:{required:!0,message:"服务内容不能为空",trigger:["blur","change"]},questionNum:{required:!0,type:"number",message:"解决问题数量不能为空",trigger:["blur","change"]},serviceDate:{required:!0,message:"服务日期不能为空",trigger:["change"]},imgs:{required:!0,message:"图片不能为空",trigger:["change"]},realAddress:{required:!0,message:"请选择位置",trigger:["change"]},process:{required:!0,message:"过程记录不能为空",trigger:["blur","change"]}}},k={__name:"index",setup(_){const k=e();a((e=>{E.value=e.enterpriseId}));const E=r(""),L=r({}),N=s({content:"",enterpriseId:"",imgs:"",isLocation:1,process:"",questionNum:"",realAddress:"",realX:"",realY:"",serviceDate:"",userId:t("user","userId")}),P=r([]),S=e=>{P.value.splice(e.index,1)},C=e=>{let a=[].concat(e.file),r=P.value.length;a.map((e=>{P.value.push({...e,status:"uploading",message:"上传中"})})),a.forEach((async e=>{const a=await f(e.url,"/file/upload");if(200===a.statusCode){let e=JSON.parse(a.data),s=P.value[r];P.value.splice(r,1,Object.assign(s,{status:"success",message:"",id:e.data})),r++}}))},D=()=>{N.imgs=P.value.map((e=>e.id)).toString(),N.enterpriseId=E.value,L.value.form.validate().then((()=>{V()}))},V=async()=>{(await h(N)).msg===w.success&&(m({title:"操作成功"}),setTimeout((function(){uni.redirectTo({url:"/pages/home/index"})}),1e3))},O=r(""),U=()=>{v({title:"加载中..."}),b({type:"wgs84",success:function(e){e.longitude,e.latitude;const a=k.VITE_MAP_KEY;O.value=`https://apis.map.qq.com/tools/locpicker?search=1&type=1&coord=32.999365,112.519993&policy=1&key=${a}&referer=myapp`,x(),window.isListen||window.addEventListener("message",(e=>{let a=e.data;a&&"locationPicker"==a.module&&a&&(O.value="",N.realX=String(a.latlng.lat),N.realY=String(a.latlng.lng),N.realAddress=a.poiname),window.isListen=!0,window.removeEventListener("message",(()=>{}),!0)}))},fail:e=>{x()}})};return(e,a)=>{const r=p(y("u-upload"),I),s=p(y("u-button"),q),t=p(y("u-input"),j),m=g;return i(),l("div",{class:"container padding_all_10"},[d(o(T),{ref_key:"form",ref:L,"form-data":N,"form-config":o(A)},{imgs:n((()=>[d(r,{"file-list":P.value,name:"1",multiple:"",capture:"","max-count":10,onAfterRead:C,onDelete:S},null,8,["file-list"])])),realAddress:n((({data:e,item:a})=>[d(t,{modelValue:e[a.dataIndex],"onUpdate:modelValue":r=>e[a.dataIndex]=r,placeholder:a.placeholder,border:"surround",disabled:""},{suffix:n((()=>[d(s,{type:"primary",size:"mini",text:"获取位置",onClick:U})])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])),_:1},8,["form-data","form-config"]),d(s,{type:"primary",size:"small",text:"提交",onClick:D}),O.value?(i(),u(m,{key:0,src:O.value},null,8,["src"])):c("v-if",!0)])}}};export{k as default};
