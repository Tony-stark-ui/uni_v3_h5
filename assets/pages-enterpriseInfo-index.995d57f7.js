import{d as t,m as e,a as s,a1 as i,o as a,c as o,w as n,e as d,p as r,b as c,i as l,a2 as u,a3 as p,x as h,B as m,C as y,E as f,g as v,_ as k,$ as x,z as b,A as g,f as _,L as S,j as I,a4 as w,k as C}from"./index.338b6ccd.js";import{a as j,b as T,c as $,d as z}from"./enterpriseLeader.1c39928d.js";import{a as N}from"./u-button.6883e742.js";import{_ as O,a as E}from"./index.bc11c543.js";import{_ as L}from"./plugin-vue_export-helper.21dcd24c.js";import{f as B}from"./config.79223371.js";import{c as V}from"./base.0d2f687c.js";import{T as H}from"./index.7e55b06c.js";import{_ as P}from"./index.6c69896d.js";import{L as F}from"./listItem.6411e25c.js";import"regenerator-runtime";import"./u-icon.1aa3d7c1.js";import"./uni-datetime-picker.5cec1977.js";import"./uni-icons.a9b6e36d.js";import"./u--textarea.97b5a670.js";/* empty css                                                             */var M=L({name:"u-sticky",mixins:[e,s,{props:{offsetTop:{type:[String,Number],default:t.sticky.offsetTop},customNavHeight:{type:[String,Number],default:44},disabled:{type:Boolean,default:t.sticky.disabled},bgColor:{type:String,default:t.sticky.bgColor},zIndex:{type:[String,Number],default:t.sticky.zIndex},index:{type:[String,Number],default:t.sticky.index}}}],data:()=>({cssSticky:!1,stickyTop:0,elId:uni.$u.guid(),left:0,width:"auto",height:"auto",fixed:!1}),computed:{style(){const t={};return this.disabled?t.position="static":this.cssSticky?(t.position="sticky",t.zIndex=this.uZindex,t.top=uni.$u.addUnit(this.stickyTop)):t.height=this.fixed?this.height+"px":"auto",t.backgroundColor=this.bgColor,uni.$u.deepMerge(uni.$u.addStyle(this.customStyle),t)},stickyContent(){const t={};return this.cssSticky||(t.position=this.fixed?"fixed":"static",t.top=this.stickyTop+"px",t.left=this.left+"px",t.width="auto"==this.width?"auto":this.width+"px",t.zIndex=this.uZindex),t},uZindex(){return this.zIndex?this.zIndex:uni.$u.zIndex.sticky}},mounted(){this.init()},methods:{init(){this.getStickyTop(),this.checkSupportCssSticky(),this.cssSticky||!this.disabled&&this.initObserveContent()},initObserveContent(){this.$uGetRect("#"+this.elId).then((t=>{this.height=t.height,this.left=t.left,this.width=t.width,this.$nextTick((()=>{this.observeContent()}))}))},observeContent(){this.disconnectObserver("contentObserver");const t=i({thresholds:[.95,.98,1]});t.relativeToViewport({top:-this.stickyTop}),t.observe(`#${this.elId}`,(t=>{this.setFixed(t.boundingClientRect.top)})),this.contentObserver=t},setFixed(t){const e=t<=this.stickyTop;this.fixed=e},disconnectObserver(t){const e=this[t];e&&e.disconnect()},getStickyTop(){this.stickyTop=uni.$u.getPx(this.offsetTop)+uni.$u.getPx(this.customNavHeight)},async checkSupportCssSticky(){this.checkCssStickyForH5()&&(this.cssSticky=!0),"android"===uni.$u.os()&&Number(uni.$u.sys().system)>8&&(this.cssSticky=!0),"ios"===uni.$u.os()&&(this.cssSticky=!0)},checkComputedStyle(){},checkCssStickyForH5(){const t=["","-webkit-","-ms-","-moz-","-o-"],e=t.length,s=document.createElement("div");for(let i=0;i<e;i++)if(s.style.position=t[i]+"sticky",""!==s.style.position)return!0;return!1}},beforeDestroy(){this.disconnectObserver("contentObserver")}},[["render",function(t,e,s,i,u,p){const h=l;return a(),o(h,{class:"u-sticky",id:u.elId,style:c([p.style])},{default:n((()=>[d(h,{style:c([p.stickyContent]),class:"u-sticky__content"},{default:n((()=>[r(t.$slots,"default",{},void 0,!0)])),_:3},8,["style"])])),_:3},8,["id","style"])}],["__scopeId","data-v-d828c848"]]);var U=L({__name:"index",setup(t){const e=u();p((t=>{2==t.status&&Z(),r.value=Number(t.status),s(t.enterpriseId),G()}));const s=async t=>{const e=await j(t);for(const s in c)c[s]=e.data[s]},i=h(""),r=h(""),c=m({address:"",companyName:"",contacts:"",contactsPhone:"",id:"",info:"",uscCode:"",x:"",y:""}),l=m({pageNum:1,pageSize:10,userId:y("user","userId")}),L=h([]),U=h(0),Z=async()=>{const t=await T(l);L.value.push(...t.data.rows),U.value=t.data.total},q=()=>{if(U.value>=L.value.length)return S({title:"没有更多数据"});l.pageNum++,Z()},A=h(""),R=h(""),D=f((()=>2===r.value)),G=()=>{D.value&&B.formItems.forEach((t=>t.disabled=!0))},K=f((()=>1===r.value?"提交":2===r.value?"审核中":"变更")),Y=()=>{const t=e.VITE_MAP_KEY;A.value=`https://apis.map.qq.com/tools/locpicker?search=1&type=1&coord=39.90849,116.374328&policy=1&key=${t}&referer=myapp`,window.isListen||window.addEventListener("message",(t=>{let e=t.data;e&&"locationPicker"==e.module&&e&&(A.value="",R.value=e,c.x=String(e.latlng.lat),c.y=String(e.latlng.lng),c.address=e.poiname),window.isListen=!0,window.removeEventListener("message",(()=>{}),!0)}))},J=async()=>{i.value.form.validate().then((t=>{1!==r.value?W():Q()}))},Q=async()=>{(await $(c)).msg===V.success&&(S({title:"操作成功"}),uni.navigateBack())},W=async()=>{c.targetId=c.id,c.userId=y("user","userId"),delete c.id;(await z(c)).msg===V.success&&(S({title:"操作成功"}),uni.navigateBack())};return(t,e)=>{const s=I(C("u-button"),N),r=I(C("u-input"),E),l=I(C("u-sticky"),M),u=w;return a(),v("div",{class:"enterpriseInfo"},[k(b("div",null,[d(g(O),{ref_key:"form",ref:i,"form-data":c,"form-config":g(B)},{address:n((({data:t,item:e})=>[d(r,{modelValue:t[e.dataIndex],"onUpdate:modelValue":s=>t[e.dataIndex]=s,placeholder:e.placeholder,border:"surround",disabled:""},{suffix:n((()=>[d(s,{disabled:g(D),type:"primary",size:"mini",text:"获取位置",onClick:Y},null,8,["disabled"])])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])),_:1},8,["form-data","form-config"]),b("div",{class:"operationBtn flex-center"},[d(s,{disabled:g(D),type:"primary",size:"small",text:g(K),onClick:J},null,8,["disabled","text"])]),g(D)?(a(),v("div",{key:0,class:"list"},[d(l,null,{default:n((()=>[b("div",{class:"stickyBox"},[d(g(H),{"title-text":"企业信息变更列表"})])])),_:1}),d(g(P),{class:"staticTox","list-data":L.value,total:U.value,onHandleScrollMore:q},{default:n((({data:t})=>[d(g(F),{info:t},null,8,["info"])])),_:1},8,["list-data","total"])])):_("v-if",!0)],512),[[x,!A.value]]),A.value?(a(),o(u,{key:0,src:A.value},null,8,["src"])):_("v-if",!0)])}}},[["__scopeId","data-v-2e259eb6"]]);export{U as default};
