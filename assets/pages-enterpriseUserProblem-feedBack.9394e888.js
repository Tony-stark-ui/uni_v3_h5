import{x as e,B as a,C as s,o as t,g as r,e as i,w as o,A as n,L as u,j as c,a8 as m,k as l}from"./index.338b6ccd.js";import{_ as p}from"./u-upload.db51c592.js";import{a as d}from"./u-button.6883e742.js";import{f}from"./model.77a3c67b.js";import{c as g}from"./base.0d2f687c.js";import{_ as j}from"./index.bc11c543.js";import{a as v}from"./enterpriseUser.c636f72b.js";import"regenerator-runtime";import"./u-icon.1aa3d7c1.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./uni-datetime-picker.5cec1977.js";import"./uni-icons.a9b6e36d.js";import"./u--textarea.97b5a670.js";const b={__name:"feedBack",setup(b){const x=e(""),_=a({enterpriseId:s("user","enterpriseId"),content:"",imgs:"",title:"",type:1,userId:s("user","userId")}),k=e([]),y=e=>{k.value.splice(e.index,1)},h=e=>{let a=[].concat(e.file),s=k.value.length;a.map((e=>{k.value.push({...e,status:"uploading",message:"上传中"})})),a.forEach((async e=>{const a=await m(e.url,"/file/upload");if(200===a.statusCode){let e=JSON.parse(a.data),t=k.value[s];k.value.splice(s,1,Object.assign(t,{status:"success",message:"",id:e.data})),s++}}))},I=()=>{_.imgs=k.value.map((e=>e.id)).toString(),x.value.form.validate().then((()=>{w()}))},w=async()=>{(await v(_)).msg===g.success&&(u({title:"提交成功"}),uni.navigateBack())};return(e,a)=>{const s=c(l("u-upload"),p),u=c(l("u-button"),d);return t(),r("div",{class:"container padding_all_10"},[i(n(j),{ref_key:"form",ref:x,"form-data":_,"form-config":n(f)},{imgs:o((()=>[i(s,{"file-list":k.value,name:"1",multiple:"",capture:"","max-count":10,onAfterRead:h,onDelete:y},null,8,["file-list"])])),_:1},8,["form-data","form-config"]),i(u,{type:"primary",size:"small",text:"提交",onClick:I})])}}};export{b as default};
