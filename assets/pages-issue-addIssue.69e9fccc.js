import{h as e}from"./enterpriseLeader.1c39928d.js";import{x as a,a3 as s,B as t,C as r,o as i,g as o,e as n,w as u,A as m,L as c,j as l,a8 as d,k as p}from"./index.338b6ccd.js";import{_ as f}from"./u-upload.db51c592.js";import{a as g}from"./u-button.6883e742.js";import{f as j}from"./model.9ad00a1d.js";import{c as v}from"./base.0d2f687c.js";import{_ as b}from"./index.bc11c543.js";import"regenerator-runtime";import"./u-icon.1aa3d7c1.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./uni-datetime-picker.5cec1977.js";import"./uni-icons.a9b6e36d.js";import"./u--textarea.97b5a670.js";const x={__name:"addIssue",setup(x){const _=a("");s((e=>{h.enterpriseId=e.enterpriseId}));const h=t({enterpriseId:"",content:"",imgs:"",title:"",type:2,userId:r("user","userId")}),y=a([]),I=e=>{y.value.splice(e.index,1)},k=e=>{let a=[].concat(e.file),s=y.value.length;a.map((e=>{y.value.push({...e,status:"uploading",message:"上传中"})})),a.forEach((async e=>{const a=await d(e.url,"/file/upload");if(200===a.statusCode){let e=JSON.parse(a.data),t=y.value[s];y.value.splice(s,1,Object.assign(t,{status:"success",message:"",id:e.data})),s++}}))},w=()=>{h.imgs=y.value.map((e=>e.id)).toString(),_.value.form.validate().then((()=>{C()}))},C=async()=>{(await e(h)).msg===v.success&&(c({title:"提交成功"}),uni.navigateBack())};return(e,a)=>{const s=l(p("u-upload"),f),t=l(p("u-button"),g);return i(),o("div",{class:"container padding_all_10"},[n(m(b),{ref_key:"form",ref:_,"form-data":h,"form-config":m(j)},{imgs:u((()=>[n(s,{"file-list":y.value,name:"1",multiple:"",capture:"","max-count":10,onAfterRead:k,onDelete:I},null,8,["file-list"])])),_:1},8,["form-data","form-config"]),n(t,{type:"primary",size:"small",text:"提交",onClick:w})])}}};export{x as default};
